<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Grafword Starter SPA | Profile</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <nav class="navbar hidden p-1 mb-2 bg-warning text-dark">
        <h2>User Profile</h2>
        <button class="btn btn-outline-dark my-0" id="logoutButton">Logout</button>
    </nav>

    <!-- User info will be displayed here -->
    <div class="position-relative">
        <div id="profileContent" class="hidden fs-5"> </div>
    </div>

    <div id="noToken" class="alert alert-secondary d-none mt-3">
        <div class="container">
            <p>Please first sign in with
                <a href="https://login.grafword.com" target="_blank" class="alert-link">Grafword</a>.
                Then <a href="#" id="applicationLink" class="alert-link">Continue with Grafword</a>.
            </p>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function () {
            const clientId = 'YOUR_CLIENT_ID';
            const grafwordDomain = 'YOUR_GRAFWORD_DOMAIN';

            var currentHost = window.location.protocol + '//' + window.location.host;
            var redirectUri = encodeURIComponent(currentHost + '/profile'); // http://localhost:8000/profile

            const authUrl = `https://${grafwordDomain}/oauth2/v1/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=id_token%20token&scope=openid%20profile%20email&prompt=none&nonce=n-0S6_WzA2Mj&state=Af0ifjslDkj`;

            document.getElementById('applicationLink').href = authUrl;


            var hash = window.location.hash.substr(1);
            var params = new URLSearchParams(hash);
            var id_token = params.get('id_token');

            if (id_token) {
                var payload = id_token.split('.')[1]; // Get the Payload part
                var decoded = atob(payload); // Base64-decode
                var user_info = JSON.parse(decoded); // Parse JSON

                // Display the navbar and user information
                document.querySelector('.navbar').classList.remove('hidden');
                document.getElementById('profileContent').innerHTML += "<p>Name: " + (user_info.name || "User") + "</p>";
                document.getElementById('profileContent').innerHTML += "<p>Email: " + (user_info.email || "User") + "</p>";
                document.getElementById('profileContent').classList.remove('hidden');
            } else {
                document.getElementById('noToken').classList.remove('d-none');
            }

            document.getElementById('logoutButton').addEventListener('click', function () {
                var oktaDomain = 'https://dev-266224.okta.com';
                var postLogoutRedirectUri = encodeURIComponent(currentHost + '/');

                var logoutUrl = oktaDomain + '/oauth2/v1/logout' +
                    '?id_token_hint=' + encodeURIComponent(id_token) +
                    '&post_logout_redirect_uri=' + postLogoutRedirectUri;

                window.location.href = logoutUrl;
            });
        })();
    </script>
</body>

</html>